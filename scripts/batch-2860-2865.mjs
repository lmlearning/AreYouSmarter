#!/usr/bin/env node
import { readFile, writeFile } from 'fs/promises';

const newExplanations = [
  {
    "questionId": "high_school_biology_36",
    "explanation": "Darwin would have REJECTED: **\"The smallest entity that can evolve is an individual organism.\"**\n\nDarwin understood that populations, not individuals, evolve.\n\n**What Darwin accepted:**\n\n**Option 0: Environmental change plays a role**\n- **Darwin ACCEPTED** ✓\n- Changing environments create new selective pressures\n- Galapagos islands showed environmental adaptation\n- Key part of natural selection theory\n\n**Option 2: Individuals acquire new characteristics**\n- **DEBATABLE** - Darwin initially accepted some Lamarckian ideas\n- Later editions of Origin mentioned \"use and disuse\"\n- But his main theory was natural selection, not acquired traits\n- Modern biology rejects Lamarckian inheritance\n- But Darwin wasn't completely Lamarckian-free\n\n**Option 3: Inherited variation necessary for selection**\n- **Darwin ACCEPTED** ✓\n- Central to natural selection\n- Variation must exist and be heritable\n- Without variation, no evolution\n- Key insight from breeding\n\n**Option 1 is WHAT DARWIN WOULD REJECT:**\n\"The smallest entity that can evolve is an individual organism\" ✗\n\n**Why Darwin would reject this:**\n\n**Individuals don't evolve:**\n- Individual organisms have fixed traits\n- Born with certain characteristics\n- May change during life (growth, learning) but not genetic evolution\n- Reproduction produces variation in OFFSPRING\n- **Individual → dies same genotype it was born with**\n\n**Populations evolve:**\n- Collection of individuals with varying traits\n- Some survive better, reproduce more\n- Allele frequencies change over generations\n- **Population changes composition over time**\n\n**Darwin's view:**\n- Natural selection acts on individuals (differential survival)\n- But evolutionary change occurs in populations\n- \"Descent with modification\"\n- Populations change, not individuals\n\n**Example: Giraffe necks:**\n\n**WRONG (Lamarckian, individual evolution):**\n- Individual giraffe stretches neck\n- Neck becomes longer during lifetime\n- Passes longer neck to offspring\n- **Darwin didn't fully believe this**\n\n**RIGHT (Darwinian, population evolution):**\n- Population has variation in neck length\n- Longer-necked individuals reach more food\n- Survive better, have more offspring\n- **Population** shifts toward longer necks over generations\n- No individual giraffe evolves\n\n**Modern understanding:**\n\n**Correct:**\n- Populations are evolutionary units\n- Allele frequencies change\n- Natural selection on individuals → population evolution\n\n**Incorrect (option 1):**\n- Individuals as evolutionary units\n- Individuals don't change genetically\n- Can't evolve in biological sense\n\n**The other option (2) - acquired characteristics:**\n\nDarwin DID entertain some Lamarckian ideas:\n- Theory of \"pangenesis\" (gemmules)\n- Use and disuse mentioned in Origin\n- But his MAIN mechanism was natural selection\n- Modern synthesis completely rejects Lamarckism\n- Weismann barrier: soma doesn't affect germline\n\nHowever, option 1 (individuals evolve) is MORE clearly something Darwin would reject because:\n- Central to his theory: populations vary and change\n- Explicitly stated evolution is descent with modification in lineages\n- Individuals die; lineages persist and change\n\n**Answer: Option 1** ✓\n\nDarwin understood evolution occurs in populations across generations, not within individuals.",
    "reasoning": "Darwin: populations evolve, not individuals. Individual has fixed genotype. Population changes allele frequencies. Darwin accepted: environmental change (drives selection), inherited variation (necessary). Accepted some acquired traits (pangenesis) but main theory was selection. Would reject: individuals as evolutionary units. Answer: option 1 (individual evolves).",
    "steps": [
      "Evolution = change over generations",
      "Individuals have fixed genes",
      "Populations change composition",
      "Darwin: natural selection on populations",
      "Would reject individuals evolving",
      "Answer: option 1 ✓ (individual evolves)"
    ],
    "generatedAt": "2025-01-14T17:15:00.000Z",
    "correctedAnswer": 1
  },
  {
    "questionId": "high_school_biology_37",
    "explanation": "**Mutation** contributes the MOST to genetic variability by creating new alleles.\n\n**Sources of genetic variation:**\n\n**1. Mutation (ULTIMATE SOURCE):**\n- Creates NEW alleles\n- Only source of novel genetic material\n- DNA changes: substitutions, insertions, deletions\n- Spontaneous or induced\n- **MOST IMPORTANT FOR LONG-TERM VARIATION** ✓\n\n**2. Sexual reproduction:**\n- Shuffles existing alleles\n- Crossing over, independent assortment\n- Creates new combinations\n- But doesn't create new alleles\n\n**3. Gene flow:**\n- Migration between populations\n- Introduces existing alleles from other populations\n- Important but doesn't create new alleles\n\n**Why option 3 (Mutation) is CORRECT:**\n\n**Mutation advantages:**\n- **Only source of new alleles**\n- Creates genetic information\n- Raw material for evolution\n- Without mutation, variation would be depleted\n- All current variation originated from past mutations\n\n**Types of mutations:**\n- **Point mutations**: Single base change\n- **Insertions/deletions**: Add/remove bases\n- **Duplications**: Copy genes\n- **Chromosomal**: Large-scale changes\n- **Gene flow**: Horizontal gene transfer (bacteria)\n\n**Why other options are WRONG:**\n\n**Option 0: Sporulation**\n- Formation of spores\n- **Asexual reproduction** (in fungi, plants, protists)\n- Produces CLONES (genetically identical)\n- **NO genetic variation**\n- Opposite of what we want\n\n**Option 1: Binary fission**\n- Bacterial asexual reproduction\n- Cell divides into two identical cells\n- **Clonal** (no variation)\n- Except for occasional mutations\n- But mutation itself is the source, not binary fission\n\n**Option 2: Vegetative propagation**\n- Asexual plant reproduction\n- Runners, tubers, cuttings, grafting\n- Produces **clones**\n- Potatoes, strawberries, bananas\n- **NO genetic variation** (identical to parent)\n\n**Pattern:**\n- Options 0, 1, 2 are all **ASEXUAL reproduction**\n- Asexual = clones = no variation\n- Only mutation adds variation in asexual organisms\n\n**Mutation rates:**\n- Humans: ~1-2 × 10⁻⁸ per base per generation\n- Low per site, but genome is large (3 billion bases)\n- Each human has ~60-100 new mutations\n- Accumulates over evolutionary time\n\n**Mutation types by effect:**\n\n**Neutral (~70%):**\n- No effect on fitness\n- Drift in population\n- Most common\n\n**Deleterious (~29%):**\n- Harmful\n- Removed by selection\n- Rarely spread\n\n**Beneficial (~1%):**\n- Advantageous\n- Increased by selection\n- Source of adaptation\n\n**Examples of important mutations:**\n- **Lactase persistence**: Adult milk digestion\n- **Sickle cell**: Malaria resistance (when heterozygous)\n- **CCR5-Δ32**: HIV resistance\n- **MC1R**: Red hair\n- **Antibiotic resistance genes**: Bacteria\n\n**Sexual reproduction vs. Mutation:**\n\n**Sexual reproduction:**\n- **Rearranges** existing alleles\n- Creates new combinations\n- Increases variation in short term\n- But needs existing diversity\n\n**Mutation:**\n- **Creates** new alleles\n- Necessary for long-term variation\n- Without it, selection would deplete variation\n- Ultimate source\n\n**In asexual organisms:**\n- ONLY source of variation is mutation\n- No recombination\n- Bacteria, some plants, bdelloid rotifers\n- Evolution slower (no recombination advantage)\n\n**The question asks \"MOST\":**\n- While sexual reproduction generates lots of variation\n- It only shuffles what exists\n- **Mutation is ULTIMATE source**\n- Without mutation, no raw material for other processes\n\nMutation is the ultimate source of genetic variation, creating entirely new alleles.",
    "reasoning": "Genetic variability sources: mutation (creates new alleles), sexual reproduction (shuffles existing), gene flow (introduces existing). Sporulation, binary fission, vegetative propagation are asexual (no variation, clones). Mutation = ONLY creates new genetic material. Answer: option 3 (mutation).",
    "steps": [
      "Variation needs new alleles",
      "Asexual reproduction = clones (no variation)",
      "Sporulation, binary fission, vegetative = asexual",
      "Mutation creates new alleles",
      "Ultimate source of variation",
      "Answer: option 3 ✓ (mutation)"
    ],
    "generatedAt": "2025-01-14T17:16:00.000Z",
    "correctedAnswer": 3
  },
  {
    "questionId": "high_school_biology_38",
    "explanation": "**The appendix has defensive lymphatic tissue**, which DETRACTS FROM (argues against) calling it a \"completely vestigial\" organ.\n\n**Vestigial organ definition:**\n- Reduced or degenerate structure\n- Lost most/all original function\n- Retained from evolutionary ancestor\n- Example: Human tailbone, whale pelvic bones\n\n**Question asks: What DETRACTS FROM vestigial claim?**\n(What suggests appendix ISN'T completely useless?)\n\n**Option 2 is CORRECT:**\n\"The appendix has a substantial amount of defensive lymphatic tissue\" ✓\n- Shows appendix HAS A FUNCTION\n- Not completely useless\n- Arguments AGAINST pure vestigiality\n- Immune function = adaptive value\n\n**Appendix functions (modern understanding):**\n\n**1. Immune function:**\n- **Gut-associated lymphoid tissue (GALT)**\n- Produces antibodies (IgA)\n- Lymphocytes, white blood cells\n- Part of immune system\n\n**2. Bacterial reservoir:**\n- \"Safe house\" for beneficial gut bacteria\n- After diarrhea/illness, recolonizes gut\n- Biofilm harbor\n- Recent discovery (2007)\n\n**3. Development:**\n- Important in fetal immune development\n- May train immune system\n\n**These functions suggest NOT completely vestigial**\n\n**Why other options DON'T detract:**\n\n**Option 0: Can be removed with no immediate ill effects**\n- **SUPPORTS vestigial claim**\n- Shows not essential for survival\n- Many people live without appendix\n- Strengthens vestigial argument\n- Does NOT detract\n\n**Option 1: Might have been larger in fossil hominids**\n- **SUPPORTS vestigial claim**\n- Shows reduction over time\n- Classic vestigial pattern (reduction)\n- Evidence FOR vestigiality\n- Does NOT detract\n\n**Option 3: Larger appendix → fewer offspring**\n- **SUPPORTS vestigial claim**\n- Shows selection AGAINST large appendix\n- Evolutionary reduction occurring\n- Suggests becoming more vestigial\n- Does NOT detract\n\n**The argument:**\n\n**Pro-vestigial evidence:**\n- Can be removed (option 0)\n- Was larger in ancestors (option 1)\n- Selected against if larger (option 3)\n- Inflammation common (appendicitis)\n- No obvious critical function\n\n**Anti-vestigial evidence:**\n- Has immune function (option 2) ✓\n- Bacterial reservoir\n- Retained across mammals\n- Some adaptive value\n\n**Option 2 DETRACTS (argues against) vestigial claim**\n\n**Modern view of \"vestigial\":**\n\n**Old definition:**\n- Completely functionless\n- Useless remnant\n\n**Modern definition:**\n- **Reduced from ancestral state**\n- May retain SOME function\n- Not as important as it was\n- But not necessarily useless\n\n**The appendix:**\n- Probably reduced from larger cecum\n- Herbivorous ancestors needed larger cecum for cellulose\n- Humans: smaller cecum + appendix\n- Appendix retained some immune function\n- **Not COMPLETELY vestigial** (has function)\n- But may be **partially vestigial** (reduced from ancestor)\n\n**Evolutionary perspective:**\n- Hominid ancestors: Herbivorous, larger gut\n- Cecum important for fermentation\n- Humans: Omnivorous, smaller gut\n- Appendix: Remnant with new function (immune)\n- Example of **exaptation** (new function for old structure)\n\n**Other vestigial structures:**\n- **Human tailbone**: Remnant of tail\n- **Wisdom teeth**: Remnant of larger jaw\n- **Whale pelvic bones**: Remnant of legs\n- **Snake vestigial legs**: Some species have tiny bones\n\nLymphatic tissue shows the appendix has an immune function, arguing against complete vestigiality.",
    "reasoning": "Question: what DETRACTS from (argues against) vestigial claim? Lymphatic tissue = has function (immune) = NOT completely useless = detracts from vestigial. Options 0, 1, 3 all SUPPORT vestigial (can remove, was larger, selected against). Answer: option 2 (lymphatic tissue).",
    "steps": [
      "Vestigial = useless remnant",
      "Detract = argue against uselessness",
      "Lymphatic tissue = immune function",
      "Has function = not useless",
      "Detracts from vestigial claim",
      "Answer: option 2 ✓ (lymphatic tissue)"
    ],
    "generatedAt": "2025-01-14T17:17:00.000Z",
    "correctedAnswer": 2
  },
  {
    "questionId": "high_school_biology_39",
    "explanation": "Before oxygen filled the atmosphere, **autotrophs (which make their own food) had to evolve**.\n\n**Heterotroph hypothesis:**\n\nTheory about origin of life and early metabolism:\n\n**Sequence of events:**\n\n**1. Primordial soup (4 billion years ago):**\n- Organic molecules from abiotic processes\n- Miller-Urey conditions\n- Simple compounds in oceans\n\n**2. First life - heterotrophs (~3.8 Ga):**\n- Consumed organic molecules from environment\n- Fermentation for energy\n- No photosynthesis yet\n- **NO OXYGEN PRODUCTION**\n\n**3. Organic molecules depleted:**\n- Heterotrophs consumed faster than abiotic production\n- Food scarcity\n- Selection for organisms that could make own food\n\n**4. Autotrophs evolved (~3.5-2.7 Ga):**\n- **Photosynthesis** (cyanobacteria)\n- Could make organic molecules from CO₂ and sunlight\n- **PRODUCED OXYGEN as byproduct**\n- 6CO₂ + 6H₂O → C₆H₁₂O₆ + 6O₂\n\n**5. Oxygen accumulated (~2.4 Ga):**\n- Great Oxygenation Event\n- Atmosphere changed from reducing to oxidizing\n- Enabled aerobic respiration\n\n**Option 1 is CORRECT:**\n\"Autotrophs, which make their own food, had to evolve\" ✓\n- Necessary BEFORE oxygen accumulation\n- Photosynthetic autotrophs produced O₂\n- Cyanobacteria were first\n\n**Why other options are WRONG:**\n\n**Option 0: Heterotrophs remove CO₂**\n- **OPPOSITE**\n- Heterotrophs PRODUCE CO₂ (respiration)\n- Don't remove it\n- Not relevant to oxygen production\n\n**Option 2: Heterotrophs had to evolve**\n- **ALREADY EXISTED**\n- Heterotroph hypothesis says heterotrophs came FIRST\n- They existed before autotrophs\n- Already present before oxygen\n- Wrong order\n\n**Option 3: Autotrophs convert nitrogen to nitrate**\n- **WRONG PROCESS**\n- Nitrogen fixation ≠ oxygen production\n- Some autotrophs do nitrogen fixation\n- But that doesn't produce oxygen\n- Photosynthesis produces oxygen\n\n**Timeline:**\n\n**~4.0 Ga: Earth forms**\n- No life\n- Reducing atmosphere (no O₂)\n\n**~3.8 Ga: First life (heterotrophs)**\n- Consume organic molecules\n- Fermentation\n- No oxygen production\n\n**~3.5 Ga: Stromatolites (first fossils)**\n- Cyanobacteria mats\n- Photosynthesis begins\n\n**~2.7 Ga: Cyanobacteria widespread**\n- Oxygenic photosynthesis\n- O₂ production increases\n- But absorbed by ocean/rocks\n\n**~2.4 Ga: Great Oxygenation Event**\n- Sinks saturated\n- Oxygen accumulates in atmosphere\n- From ~0% to ~1-2%\n- Eventually reached ~21% (today)\n\n**Why autotrophs necessary:**\n\n**Before autotrophs:**\n- Only heterotrophs existed\n- Consumed abiotic organic molecules\n- Respiration/fermentation produced CO₂\n- **NO oxygen production**\n\n**After autotrophs evolved:**\n- Photosynthesis: CO₂ + H₂O → organic + O₂\n- Oxygen as waste product\n- Accumulated over millions of years\n- Changed Earth's atmosphere\n\n**Types of autotrophs:**\n\n**Photoautotrophs:**\n- Use light energy\n- Cyanobacteria, algae, plants\n- **PRODUCE OXYGEN** (oxygenic photosynthesis)\n\n**Chemoautotrophs:**\n- Use chemical energy\n- Some bacteria (sulfur, iron bacteria)\n- Don't produce oxygen\n- Not relevant to Great Oxygenation Event\n\n**The Great Oxygenation Event:**\n- Largest pollution event ever\n- Oxygen was TOXIC to anaerobes\n- Mass extinction of anaerobic life\n- Enabled aerobic metabolism\n- Much more efficient (38 ATP vs 2)\n- Allowed complex multicellular life\n\nPhotosynthetic autotrophs evolved first, then produced oxygen that gradually filled the atmosphere.",
    "reasoning": "Heterotroph hypothesis: heterotrophs first (consume organics). To get oxygen: need photosynthesis. Photosynthesis = autotrophs. Autotrophs had to evolve to produce O₂. Heterotrophs already existed (came first). Heterotrophs produce CO₂ (not remove). Nitrogen fixation unrelated to O₂. Answer: option 1 (autotrophs evolve).",
    "steps": [
      "Oxygen from photosynthesis",
      "Photosynthesis = autotrophs",
      "Autotrophs had to evolve first",
      "Then O₂ produced as byproduct",
      "Accumulated over time",
      "Answer: option 1 ✓ (autotrophs evolve)"
    ],
    "generatedAt": "2025-01-14T17:18:00.000Z",
    "correctedAnswer": 1
  },
  {
    "questionId": "high_school_biology_40",
    "explanation": "Two related species evolving to become LESS similar is **divergent evolution**.\n\n**Types of evolution:**\n\n**1. Divergent evolution:**\n- **Related species → different traits**\n- Common ancestor\n- Adapt to different environments/niches\n- Become MORE different over time\n- **THIS IS THE ANSWER** ✓\n\n**2. Convergent evolution:**\n- Unrelated species → similar traits\n- Similar environments\n- Analogous structures\n- Become MORE similar\n\n**3. Parallel evolution:**\n- Related species → similar traits independently\n- Similar environments\n- Common genetic background\n\n**4. Coevolution:**\n- Two species evolve in response to each other\n- Reciprocal adaptations\n- Predator-prey, mutualism\n\n**Option 0 is CORRECT: Divergent evolution** ✓\n\n**Key word: \"LESS similar\"**\n- Related species (common ancestor)\n- Become LESS similar (diverge)\n- **Divergent = move apart**\n\n**Divergent evolution examples:**\n\n**Darwin's finches:**\n- Common ancestor colonized Galapagos\n- Different islands, different food sources\n- Beaks diverged:\n  - Large beaks for seeds\n  - Small beaks for insects\n  - Pointed beaks for cactus\n- **Adaptive radiation**\n\n**Mammalian limbs:**\n- Homologous structures\n- Common tetrapod ancestor\n- Diverged for different functions:\n  - Human arm: manipulation\n  - Whale flipper: swimming\n  - Bat wing: flying\n  - Mole forelimb: digging\n- Same bones, different shapes/functions\n\n**Anole lizards (Caribbean):**\n- Different species on different islands\n- Evolved different body types:\n  - Trunk-crown: long legs\n  - Trunk-ground: short legs, long tail\n  - Twig: short legs, short tail\n- Diverged from common ancestor\n\n**Why other options are WRONG:**\n\n**Option 1: Convergent evolution**\n- Unrelated → similar\n- **OPPOSITE direction** (more similar, not less)\n- Question says \"less similar\"\n\n**Option 2: Parallel evolution**\n- Related → similar (independently)\n- **WRONG direction** (more similar)\n- Question says \"less similar\"\n\n**Option 3: Coevolution**\n- Two species respond to each other\n- Not necessarily becoming more or less similar\n- About reciprocal adaptation\n- Doesn't specify similarity change\n\n**Divergent vs. Convergent:**\n\n**Divergent:**\n- **Start:** Related (common ancestor)\n- **End:** Different (diverged)\n- **Structures:** Homologous\n- **Cause:** Different environments\n\n**Convergent:**\n- **Start:** Unrelated (no recent common ancestor)\n- **End:** Similar (converged)\n- **Structures:** Analogous\n- **Cause:** Similar environments\n\n**Adaptive radiation:**\n- Type of divergent evolution\n- One ancestral species → many descendants\n- Rapid diversification\n- Examples:\n  - Darwin's finches (Galapagos)\n  - Hawaiian honeycreepers\n  - Cichlid fish (African lakes)\n  - Australian marsupials\n  - Cambrian explosion\n\n**The question:**\n\n**\"Two related species\"** → Start with common ancestor\n**\"evolve in a way\"** → Change over time\n**\"makes them less similar\"** → Diverge, become different\n\n**Divergent evolution fits perfectly:**\n- Related: Check ✓\n- Become less similar: Check ✓\n- Divergent = definition matches ✓\n\nDivergent evolution describes related species becoming increasingly different over time.",
    "reasoning": "Related species becoming LESS similar = divergent evolution. Related → different (diverge). Convergent = unrelated → similar (opposite). Parallel = related → similar (opposite). Coevolution = reciprocal (not about similarity). Answer: option 0 (divergent).",
    "steps": [
      "Start: related species",
      "End: less similar",
      "Less similar = diverge",
      "Divergent evolution",
      "Examples: Darwin's finches, mammal limbs",
      "Answer: option 0 ✓ (divergent)"
    ],
    "generatedAt": "2025-01-14T17:19:00.000Z"
  }
];

// Read existing explanations
const existing = JSON.parse(await readFile('server/data/ai-explanations.json', 'utf-8'));

// Add new ones
const updated = [...existing, ...newExplanations];

// Write back
await writeFile('server/data/ai-explanations.json', JSON.stringify(updated, null, 2), 'utf-8');

console.log(`Added ${newExplanations.length} new explanations. Total: ${updated.length}`);
console.log(`Progress: ${updated.length}/14042 = ${(updated.length / 14042 * 100).toFixed(2)}%`);
